<include file="Public:header"/>
<script type="text/javascript" src="__PUBLIC__/../Install/js/ajaxForm.js"></script>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" /> 
<div class="col-sm-12 widget-container-span">
	<div class="widget-box transparent">
		<div class="widget-header">
			<div class="widget-toolbar no-border">
				<ul class="nav nav-tabs" id="myTab">
					<li class="active"><a data-toggle="tab" href="#home1">旅行プラン新規作成</a></li>
				</ul>
			</div>
		</div>

		<div class="widget-body">
			<div class="widget-main padding-12 no-padding-left no-padding-right">
				<div class="tab-content padding-4">
					<div id="home1" class="tab-pane in active">
						<div class="row">
							<div class="col-xs-12 no-padding-right">
								<div style="margin-bottom:10px">
										<strong>团号：</strong>
										<strong id="groupname"></strong>
								</div>
								<form id="makelist" action="{:U('Admin/TravelPlan/makeList')}" method="post">
									<input type="hidden" name="groupid" value="">
									<div class="table-responsive">
										<table width="70%">
											<tbody>
												<tr>
													<td>
														<label>行程开始日：</label>
													</td>
													<td>
														<input type="date" name="begindate" style="width:150px;" />
													</td>
													<td>
														<label>行程结束日：</label>
													</td>
													<td>
														<input type="date" name="enddate" style="width:150px;" />
													</td>
													<td>
														<label>人数：</label>
													</td>
													<td>
														<input type="text" name="number" \>
													</td>
													<td>
														<label>接机牌：</label>
													</td>
													<td>
														<input type="text" name="flight" \>
													</td>
												</tr>
												<tr>
													<td>
														<label>对方旅行社：</label>
													</td>
													<td>
														<select name="agencyid">
															<volist name="agencylist" id="agency">
																<option value="{$agency.id}">{$agency.name}</option>
															</volist>
														</select>
													</td>
													<td>
														<label>对方担当：</label>
													</td>
													<td>
														<select name="agentid">
															<volist name="agentlist" id="agent">
																<option value="{$agent.id}">{$agent.name}</option>
															</volist>
														</select>
													</td>
												</tr>
												<tr>
													<td /><td /><td /><td /><td /><td /><td />
													<td>
														<button type = "submit">列表生成</button>
													</td>
												</tr>
											</tbody>
										</table>
									</div>
								</form>
								<div style="margin-top:10px" class="table-responsive">
									<table id="sample-table-1"
										class="table table-striped table-bordered table-hover">
										<thead>
											<tr>
												<th>日期</th>
												<th>都道府県</th>
												<th>景点</th>
												<th>景点说明</th>
												<th>酒店名</th>
												<th>星级</th>
												<th>房间</th>
												<th>用餐</th>
											</tr>
										</thead>

										<tbody>
											<tr>
												<td>{$result.date}</td>
												<td style="padding:0px">
													<table style="width:100%">
														<for start="1" end="8"><tr>
															<td><select class="select_2" name="cityid" style="width:100%">
																<volist name="citylist" id="city">
																<option value="{$city.id}">{$city.name}</option>
																</volist>
															</select></td>
														</tr></for>
													</table>
												</td>
												<td style="padding:0px">
													<table style="width:100%">
														<for start="1" end="8"><tr>
															<td><select class="select_2" name="spotid" style="width:100%">
																<volist name="spotlist" id="spot">
																<option value="{$spot.id}">{$spot.name}</option>
																</volist>
															</select></td>
														</tr></for>
													</table>
												</td>
												<td style="padding:0px">
													<table style="width:100%">
														<for start="1" end="8"><tr>
															<td><select class="select_2" name="detail" style="width:100%">
																<volist name="detaillist" id="detail">
																<option value="{$detail.id}">{$detail.name}</option>
																</volist>
															</select></td>
															
														</tr></for>
													</table>
												</td>
												<td><select class="select_2" name="hotelid" style="width:100%">
													<volist name="hotellist" id="hotel">
														<option value="{$city.id}">{$city.name}</option>
													</volist>
												</select></td>
												<td><select class="select_2" name="star" style="width:100%">
													<volist name="starlist" id="star">
														<option value="{$star.id}">{$star.name}</option>
													</volist>
												</select></td>
												<td style="padding:0px">
													<table>
														<tr></tr>
														<tr></tr>
														<tr></tr>
													</table>
												</td>
												<td style="padding:0px">
													<table>
														<tr></tr>
														<tr></tr>
														<tr></tr>
													</table>
												</td>
											</tr>
										</tbody>
									</table>
									<div class="pagination" style="margin:0px;">
										{$page}
									</div>
								</div>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>
		<script type="text/javascript">
			function checkForm() {
				var begindate = $('input[name="begindate"]').val()
				var enddate = $('input[name="enddate"]').val()
				var number = $('input[name="number"]').val()
				var flight = $('input[name="flight"]').val()
				var agency = $('select[name="agencyid"]').val()
				var agent = $('select[name="agentid"]').val()
				if (begindate.length != 10 ||
					enddate.length != 10 ||
					number.length <= 0 ||
					flight.length <= 0 ||
					agency.length <= 0 ||
					agent.length <= 0) {
					alert("存在空字段或者无效字段！")
					return false
				}
			}
			function makeList(response) {
				if (response.data.groupname) {
					$('strong#groupname').text(response.data.groupname)
					$('input[name="groupid"]').val(response.data.groupid)
				}
			}
			$(document).ready(function(){
				$('#makelist').ajaxForm({
					beforeSubmit: checkForm,
					success: makeList
				})
			})
		</script>
	</div>
</div>