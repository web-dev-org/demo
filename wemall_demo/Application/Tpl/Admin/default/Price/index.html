<include file="Public:header"/>
<script type="text/javascript">
var UEURL = '__ROOT__/Public/Plugin/umeditor/';
</script>
<link href="__PUBLIC__/Plugin/umeditor/themes/default/css/umeditor.css" type="text/css" rel="stylesheet">
<link href="__PUBLIC__/Plugin/style/css/page.css" type="text/css" rel="stylesheet">
<script type="text/javascript" src="__PUBLIC__/Plugin/umeditor/third-party/jquery.min.js"></script>
<script type="text/javascript" charset="utf-8" src="__PUBLIC__/Plugin/umeditor/umeditor.config.js"></script>
<script type="text/javascript" charset="utf-8" src="__PUBLIC__/Plugin/umeditor/umeditor.min.js"></script>
<script type="text/javascript" src="__PUBLIC__/Plugin/umeditor/lang/zh-cn/zh-cn.js"></script>

<div class="col-sm-12 widget-container-span">
	<div class="widget-box transparent">
		<div class="widget-header">
			<div class="widget-toolbar no-border">
				<ul class="nav nav-tabs" id="myTab">
					<li class="acitve"><a data-toggle="tab" href="#home1">景点管理</a></li>
					<li><a data-toggle="tab" href="#home2">添加/修改景点</a></li>
				</ul>
			</div>
		</div>

		<div class="widget-body">
			<div class="widget-main padding-12 no-padding-left no-padding-right">
				<div class="tab-content padding-4">
					<div id="home1" class="tab-pane in active">
						<div class="row">
							<div class="col-xs-12 no-padding-right">
								<div class="table-responsive">
									<table id="sample-table-1"
										class="table table-striped table-bordered table-hover">
										<thead>
											<tr>
												<th class="center"><label> <input
														type="checkbox" class="ace"> <span class="lbl"></span>
												</label></th>
												<th>ID</th>
												<th>景点名称</th>
												<th>景点位置</th>
												<th>景点描述</th>
												<th>操作</th>
											</tr>
										</thead>

										<tbody>
										<volist name="result" id="result">
											<tr>
												<td class="center"><label> <input
														type="checkbox" class="ace"> <span class="lbl"></span>
												</label></td>
												<td>{$result.id}</td>
												<td>{$result.name}</td>
												<td>{$result.cityname}</td>
												<td>{$result.description}</td>
												<td><a href="javascript:void(0);" onclick="reProduct(this);" class="btn btn-white btn-sm">修改</a><a class="J_ajax_del btn btn-white btn-sm" href="{:U('Admin/Product/delproduct',array('unitid'=>$result['id'],'productid'=>$result['productid'],'cityid'=>$result['cityid']))}">删除</a></td>
											</tr>
										</volist>
										</tbody>
									</table>
									<div class="pagination" style="margin:0px;">
									    {$page}
									</div>
								</div>
							</div>
						</div>
					</div>
					<div id="home2" class="tab-pane in">
						<div class="tabbable">
							<div class="tab-content">
								<div class="tab-pane active">
									
								</div>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>
		
		<script type="text/javascript">

	    	function submitPrice(button, page) {

    			actionOne = "__URL__/savePrice/page/" + page;	    			
	    		document.forms.priceform.action=actionOne;

	    		document.priceform.submit();

	    	}
	    	
	    	function changePrice(obj, row, price) {
	    		
	    		var percent = $('input[name="percent_'+row+'"]').val();
	    		var bprice = $('input[name="bprice_'+row+'"]').val();
	    		var vprice = $(obj).parent().next().html();
	    		var checkboxid = "check_" + row;
	    		
	    		if ( !isNaN( percent )) {
		    		percent = parseFloat(percent);
	    		} else {
	    			alert( "地域百分比只能输入数字！" );
	    			return;
	    		}
	    		
	    		if ( !isNaN( bprice )) {
	    			bprice = parseFloat(bprice);
	    		} else {
	    			alert( "基本价格只能输入数字！" );
	    			return;
	    		}
	    		

	    		price = parseFloat(price);
	    		
	    		if ( price != bprice ) {
	    			nprice = bprice + (bprice * percent * 0.01);
	    			nprice = Math.round(nprice*100)/100;
	    			
	    			amt = nprice - vprice;
	    			amt = Math.round(amt*100)/100;
	    			$(obj).parent().next().next().html(nprice);
	    			$(obj).parent().next().next().next().html(amt);
	    			document.getElementById(checkboxid).checked = true;
	    		}
	    		
	    	}
	    	
			function changePercent(obj, row, value) {
	    						
	    		var percent = $('input[name="percent_'+row+'"]').val();
	    		var bprice = $('input[name="bprice_'+row+'"]').val();
	    		var vprice = $(obj).parent().next().next().html();
	    		var checkboxid = "check_" + row;
	    			    		
	    		if ( !isNaN( percent )) {
		    		percent = parseFloat(percent);
	    		} else {
	    			alert( "地域百分比只能输入数字！" );
	    			return;
	    		}
	    		
	    		if ( !isNaN( bprice )) {
	    			bprice = parseFloat(bprice);
	    		} else {
	    			alert( "基本价格只能输入数字！" );
	    			return;
	    		}
	    		
	    		value = parseFloat(value);
	    		if ( value != percent ) {
	    			nprice = bprice + (bprice * percent * 0.01);
	    			nprice = Math.round(nprice*100)/100;
	    			
	    			amt = nprice - vprice;
	    			amt = Math.round(amt*100)/100;
	    			$(obj).parent().next().next().next().html(nprice);
	    			$(obj).parent().next().next().next().next().html(amt);
	    			document.getElementById(checkboxid).checked = true;
	    		}
	    		
	    	}
			
			function selectPrice() {
				var menu = $('select[name="proClass"]').val();
				var city = $('select[name="proCity"]').val();
				
				post("{:U('Admin/Price/index')}", {menuid:menu,cityid:city});
			}
			
			
			function changePage(dataNum, curPage, goPage) {	
				var datalist = new Array();
				var menu = $('select[name="proClass"]').val();
				var city = $('select[name="proCity"]').val();
				var checkboxid = "";
				var check = "";
				var pagedata = new Array();
				var index = 0;
				for ( i=0; i<dataNum; i++ ) {
					index = i + 1;
					checkboxid = "check_" + index;
					if ( document.getElementById(checkboxid).checked == true) {
						check = "1";
					} else {
						check = "";
					}
					datalist = {
							percent:$('input[name="percent_'+index+'"]').val(),
							price:$('input[name="bprice_'+index+'"]').val(),
							check:check,
							id:$('input[name="unitid_'+index+'"]').val()
					}
					
					pagedata[i] = JSON.stringify(datalist);
				}
				var data = pagedata.join("|");					
				post("{:U('Admin/Price/index')}", {page:goPage,curPage:curPage,curPageData:data,menuid:menu,cityid:city});
			}
			
			function post(URL, PARAMS) {        
			    var temp = document.createElement("form");        
			    temp.action = URL;        
			    temp.method = "post";        
			    temp.style.display = "none";        
			    for (var x in PARAMS) {        
			        var opt = document.createElement("textarea");        
			        opt.name = x;        
			        opt.value = PARAMS[x];            
			        temp.appendChild(opt);        
			    }        
			    document.body.appendChild(temp);        
			    temp.submit();        
			    return temp;        
			}        
			
		</script>
		<script type="text/javascript">
	    //实例化编辑器
	    var um = UM.getEditor('myEditor');
	    um.addListener('blur',function(){
	        $('#focush2').html('编辑器失去焦点了')
	    });
	    um.addListener('focus',function(){
	        $('#focush2').html('')
	    });
	</script>
	</div>
</div>